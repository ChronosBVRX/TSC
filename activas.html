<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Operaciones Activas</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-950 text-slate-100">
<main class="max-w-6xl mx-auto p-4 space-y-4">
  <header class="flex items-center justify-between">
    <h1 class="text-lg font-semibold">Operaciones Activas</h1>
    <a href="index.html" class="text-xs px-3 py-2 rounded-lg border border-slate-700">← Volver</a>
  </header>

  <section class="rounded-2xl border border-slate-800/70 bg-slate-900/60 p-4">
    <div class="grid lg:grid-cols-3 gap-4">

      <!-- MADRINAS -->
      <div>
        <div class="flex items-center justify-between mb-2">
          <h2 class="text-sm font-semibold">Madrinas</h2>
          <span id="count-m" class="text-[11px] text-cyan-300">0</span>
        </div>
        <ul id="list-m" class="space-y-2"></ul>
      </div>

      <!-- CONTENEDORES -->
      <div>
        <div class="flex items-center justify-between mb-2">
          <h2 class="text-sm font-semibold">Contenedores</h2>
          <span id="count-c" class="text-[11px] text-cyan-300">0</span>
        </div>
        <div class="text-[11px] text-slate-400 mb-2">* En cuanto definas su alta y guardes con <code>tipo: "CONTENEDORES"</code>, se listarán aquí.</div>
        <ul id="list-c" class="space-y-2"></ul>
      </div>

      <!-- NACIONALES -->
      <div>
        <div class="flex items-center justify-between mb-2">
          <h2 class="text-sm font-semibold">Nacionales</h2>
          <span id="count-n" class="text-[11px] text-cyan-300">0</span>
        </div>
        <div class="text-[11px] text-slate-400 mb-2">* En cuanto definas su alta y guardes con <code>tipo: "NACIONALES"</code>, se listarán aquí.</div>
        <ul id="list-n" class="space-y-2"></ul>
      </div>

    </div>
  </section>
</main>

<!-- Supabase -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
  const SUPABASE_URL = "https://xugajqlyvojqeciawpzj.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh1Z2FqcWx5dm9qcWVjaWF3cHpqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE3NjM4MzksImV4cCI6MjA3NzMzOTgzOX0.tt2_6zqf9R0cGO6Fenx_FJO6sAg6jM_CYY1Peuq6Qyo";
  const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  const listM = document.getElementById('list-m');
  const listC = document.getElementById('list-c');
  const listN = document.getElementById('list-n');
  const countM = document.getElementById('count-m');
  const countC = document.getElementById('count-c');
  const countN = document.getElementById('count-n');

  function li(op){
    const li = document.createElement('li');
    li.className = "rounded-lg border border-slate-800 bg-slate-900 p-3";
    li.innerHTML = `
      <div class="flex items-center justify-between">
        <div class="text-xs font-semibold">${op.eco || '—'} <span class="text-slate-400 font-normal">(${op.viaje || '—'})</span></div>
        <div class="text-[11px] text-slate-400">${op.vins ?? 0} VINS</div>
      </div>
      <div class="text-[11px] text-cyan-300 mt-1">${op.status || ''}</div>
    `;
    return li;
  }

  async function load(){
    const { data, error } = await sb
      .from('ops_active')
      .select('eco, vins, viaje, status, tipo')
      .order('id', { ascending: false }); // si tienes id; si no, ordénalo por created_at

    if (error) { console.error(error); return; }

    // Limpia
    for (const ul of [listM,listC,listN]) ul.innerHTML = '';
    let m=0,c=0,n=0;

    for (const op of data){
      switch ((op.tipo || 'MADRINAS').toUpperCase()){
        case 'MADRINAS':
          listM.appendChild(li(op)); m++; break;
        case 'CONTENEDORES':
          listC.appendChild(li(op)); c++; break;
        case 'NACIONALES':
          listN.appendChild(li(op)); n++; break;
        default:
          // si llega algo con otro tipo, lo metemos a Madrinas por compat.
          listM.appendChild(li(op)); m++; break;
      }
    }

    countM.textContent = m;
    countC.textContent = c;
    countN.textContent = n;
  }

  // Carga inicial
  load();

  // (Opcional) Refresco cada 30s
  setInterval(load, 30000);
</script>
</body>
</html>

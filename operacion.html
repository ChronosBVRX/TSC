<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Operaci√≥n del d√≠a</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  :root{--bg:#05070b;--panel:#0b1220;--edge:#101826;--txt:#c7d2fe;--cyan:#22d3ee;--vio:#8b5cf6;--rose:#fb7185;}
  body{color:#e5e7eb;background:radial-gradient(1200px 800px at 10% 0%,#0b1220 0%,transparent 60%),radial-gradient(800px 600px at 90% 10%,#0a1630 0%,transparent 55%),linear-gradient(180deg,#05070b 0%,#070b12 60%,#05070b 100%);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;}
  .neon{border:1px solid #0f1b2e;background:linear-gradient(180deg,#0b1220 0%,#0a1323 100%),rgba(0,0,0,.4);box-shadow:0 0 0 1px rgba(34,211,238,.15) inset,0 0 32px rgba(34,211,238,.06);}
  .glow{box-shadow:0 0 0 1px rgba(34,211,238,.18) inset,0 0 24px rgba(139,92,246,.12)}
  .in{border:1px solid #1f2a40;background:#0e1423;border-radius:.75rem;padding:.6rem .8rem;outline:none}
  .in:focus{box-shadow:0 0 0 2px rgba(34,211,238,.35)}
  label>span{font-size:.72rem;color:#cbd5e1}
  .grid-3{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:.75rem}
  .grid-4{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:.75rem}
  .grid-5{display:grid;grid-template-columns:repeat(5,minmax(0,1fr));gap:.75rem}
  @media(max-width:1024px){.grid-3,.grid-4,.grid-5{grid-template-columns:1fr}}
</style>
</head>
<body class="min-h-screen">
<main class="max-w-6xl mx-auto p-4 space-y-4">

<!-- üîπ ENCABEZADO -->
<section class="neon glow rounded-2xl p-4 space-y-3">
  <div class="flex items-center justify-between mb-3">
    <div class="flex items-center gap-3">
      <img class="h-10 w-10 rounded-xl ring-1 ring-cyan-400/40 bg-cyan-500/20"
        src="https://raw.githubusercontent.com/ChronosBVRX/TSC/main/Imagen%20de%20WhatsApp%202025-10-29%20a%20las%2013.29.51_292c634c.jpg" alt="TSC">
      <div>
        <h2 class="text-sm font-semibold leading-tight">Programaci√≥n del d√≠a</h2>
        <p class="text-[11px] text-slate-400">Encabezado din√°mico seg√∫n tipo de operaci√≥n</p>
      </div>
    </div>
    <img id="logo-right" class="h-10 rounded border border-slate-700" style="display:none">
  </div>

  <!-- Contenedor din√°mico del header -->
  <div id="header-fields" class="space-y-3"></div>
</section>

<!-- üîπ TABS -->
<section class="neon glow rounded-2xl p-2">
  <div class="flex gap-2 p-2">
    <button class="px-3 py-2 text-xs rounded border border-slate-700" data-tab="madrinas" aria-selected="true">Madrinas</button>
    <button class="px-3 py-2 text-xs rounded border border-slate-700" data-tab="nacionales">Nacionales</button>
    <button class="px-3 py-2 text-xs rounded border border-slate-700" data-tab="contenedores">Contenedores</button>
    <div class="ml-auto">
      <a href="activas.html" class="px-3 py-2 text-xs rounded border border-slate-700">Ir a Activas</a>
    </div>
  </div>

  <!-- FORMULARIOS -->
  <div id="forms-container" class="p-4 space-y-3"></div>
</section>
</main>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
const sb = supabase.createClient(
  "https://xugajqlyvojqeciawpzj.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh1Z2FqcWx5dm9qcWVjaWF3cHpqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE3NjM4MzksImV4cCI6MjA3NzMzOTgzOX0.tt2_6zqf9R0cGO6Fenx_FJO6sAg6jM_CYY1Peuq6Qyo"
);

const LOGO_RIGHT={
 "": "",
 HADRON:"https://raw.githubusercontent.com/ChronosBVRX/TSC/main/hadron.jpg",
 RAPIDOS:"https://raw.githubusercontent.com/ChronosBVRX/TSC/main/RAPIDOS-DE-MICHOACAN-1.jpg"
};
const $=s=>document.querySelector(s);

let currentTab='madrinas';

// ===== Renderizado din√°mico del encabezado =====
async function renderHeader(tab){
  const container = $('#header-fields');
  container.innerHTML='';
  let html='';
  if(tab==='madrinas'){
    html=`<div class="grid-3">
      <label class="grid gap-1"><span>Cliente</span><input id="h-cliente" class="in" value="FORD"></label>
      <label class="grid gap-1"><span>Buque</span><input id="h-buque" class="in" placeholder="LAPIS ARROW"></label>
      <label class="grid gap-1"><span>Fecha</span><input id="h-fecha" type="date" class="in"></label>
    </div>
    <div class="grid-3 items-end">
      <label class="grid gap-1 text-xs"><span>Transportista</span>
        <select id="h-transportista" class="in">
          <option value="">‚Äî Ninguno ‚Äî</option>
          <option value="HADRON">HADRON</option>
          <option value="RAPIDOS">R√ÅPIDOS</option>
        </select>
      </label>
    </div>`;
  } else if(tab==='nacionales'){
    html=`<div class="grid-3">
      <label class="grid gap-1"><span>Fecha</span><input id="h-fecha" type="date" class="in"></label>
      <label class="grid gap-1"><span>Zona / Ruta</span><input id="h-zona" class="in" placeholder="L√°zaro - Celaya"></label>
      <label class="grid gap-1"><span>Transportista</span>
        <select id="h-transportista" class="in">
          <option value="">‚Äî Ninguno ‚Äî</option>
          <option value="HADRON">HADRON</option>
          <option value="RAPIDOS">R√ÅPIDOS</option>
        </select>
      </label>
    </div>`;
  } else {
    html=`<div class="grid-3">
      <label class="grid gap-1"><span>Fecha</span><input id="h-fecha" type="date" class="in"></label>
      <label class="grid gap-1"><span>Terminal</span><input id="h-terminal" class="in" placeholder="LCTPC / SSA"></label>
      <label class="grid gap-1"><span>Transportista</span>
        <select id="h-transportista" class="in">
          <option value="">‚Äî Ninguno ‚Äî</option>
          <option value="HADRON">HADRON</option>
          <option value="RAPIDOS">R√ÅPIDOS</option>
        </select>
      </label>
    </div>`;
  }
  container.innerHTML=html;
  $('#h-fecha').value=new Date().toISOString().slice(0,10);
  loadHeader(tab);
  $('#h-transportista').addEventListener('change',()=>updateLogo());
}

// ===== Guardado / carga de encabezados =====
async function loadHeader(tab){
  const {data,error}=await sb.from('header_'+tab).select('*').eq('id','dia').maybeSingle();
  if(!error && data){
    Object.keys(data).forEach(k=>{
      const el=$('#h-'+k); if(el) el.value=data[k];
    });
    updateLogo(data.transportista);
  }
}
async function saveHeader(tab){
  const payload={id:'dia'};
  document.querySelectorAll('#header-fields [id^="h-"]').forEach(i=>{
    payload[i.id.replace('h-','')]=i.value;
  });
  await sb.from('header_'+tab).upsert(payload);
}

function updateLogo(val){
  const t=val||$('#h-transportista').value||'';
  const url=LOGO_RIGHT[t]||'';
  const img=$('#logo-right');
  if(url){img.src=url;img.style.display='block';}else{img.src='';img.style.display='none';}
}

// ===== Render de formularios =====
function renderForm(tab){
  const container=$('#forms-container');
  container.innerHTML='';
  if(tab==='madrinas'){
    container.innerHTML=`
    <h3 class="text-sm font-semibold mb-3">Agregar operaci√≥n ‚Äì Madrinas</h3>
    <div class="grid-5">
      <label class="grid gap-1"><span>Eco</span><input id="m-eco" class="in"></label>
      <label class="grid gap-1"><span>N¬∞ de VINS</span><input id="m-vins" type="number" class="in"></label>
      <label class="grid gap-1"><span>N¬∞ de Viaje</span><input id="m-viaje" class="in"></label>
      <label class="grid gap-1"><span>Status</span><select id="m-status" class="in"><option>TRAYECTO A ASLA</option><option>EN TERMINAL PROCESO DE CARGA</option><option>DESCARGADO 100%</option></select></label>
      <div class="flex items-end"><button id="btn-add" class="bg-cyan-600 hover:bg-cyan-500 px-3 py-2 text-xs rounded-lg">Agregar</button></div>
    </div>`;
  }else if(tab==='nacionales'){
    container.innerHTML=`
    <h3 class="text-sm font-semibold mb-3">Agregar operaci√≥n ‚Äì Nacionales</h3>
    <div class="grid-4">
      <label class="grid gap-1"><span>Econ√≥mico</span><input id="n-economico" class="in"></label>
      <label class="grid gap-1"><span>Placa</span><input id="n-placa" class="in"></label>
      <label class="grid gap-1"><span>Operador</span><input id="n-operador" class="in"></label>
      <label class="grid gap-1"><span>Status</span><select id="n-status" class="in"><option>EN RUTA</option><option>ENTREGADO</option></select></label>
    </div>
    <div class="flex justify-end"><button id="btn-add" class="bg-cyan-600 hover:bg-cyan-500 px-3 py-2 text-xs rounded-lg">Agregar</button></div>`;
  }else{
    container.innerHTML=`
    <h3 class="text-sm font-semibold mb-3">Agregar operaci√≥n ‚Äì Contenedores</h3>
    <div class="grid-4">
      <label class="grid gap-1"><span>Transporte</span><input id="c-transporte" class="in"></label>
      <label class="grid gap-1"><span>Operador</span><input id="c-operador" class="in"></label>
      <label class="grid gap-1"><span>Contenedor</span><input id="c-contenedor" class="in"></label>
      <label class="grid gap-1"><span>Status</span><select id="c-status" class="in"><option>REGISTRADO</option><option>ENTREGADO</option></select></label>
    </div>
    <div class="flex justify-end"><button id="btn-add" class="bg-cyan-600 hover:bg-cyan-500 px-3 py-2 text-xs rounded-lg">Agregar</button></div>`;
  }
  $('#btn-add').addEventListener('click',()=>addOp(tab));
}

// ===== Guardar operaciones =====
async function addOp(tab){
  await saveHeader(tab);
  if(tab==='madrinas'){
    await sb.from('ops_active').insert({tipo:'MADRINAS',eco:$('#m-eco').value,vins:$('#m-vins').value,viaje:$('#m-viaje').value,status:$('#m-status').value});
  }else if(tab==='nacionales'){
    await sb.from('ops_nacionales').insert({economico:$('#n-economico').value,placa:$('#n-placa').value,operador:$('#n-operador').value,status:$('#n-status').value});
  }else{
    await sb.from('ops_contenedores').insert({transporte:$('#c-transporte').value,operador:$('#c-operador').value,contenedor:$('#c-contenedor').value,status:$('#c-status').value});
  }
  alert('Operaci√≥n registrada correctamente');
}

// ===== Inicializaci√≥n =====
(async()=>{
  document.querySelectorAll('[data-tab]').forEach(b=>{
    b.onclick=()=>{document.querySelectorAll('[data-tab]').forEach(x=>x.setAttribute('aria-selected','false'));b.setAttribute('aria-selected','true');
      currentTab=b.dataset.tab;renderHeader(currentTab);renderForm(currentTab);}
  });
  renderHeader(currentTab);
  renderForm(currentTab);
})();
</script>
</body>
</html>
